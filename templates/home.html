{% extends "base.html" %}

{% block title %}Jonibek's blog{% endblock %}

{% block content %}

<h2>Recent posts</h2>

<form method="get" class="search-form">
  <input
    type="text"
    name="search"
    placeholder="Search within posts..."
    value="{{ search }}"
  >
  <button type="submit">Search</button>
</form>

{% if posts %}
  {% for post in posts %}
    <article class="post-card">
      <h3>
        <a href="/post/{{ post.slug }}">
          {{ post.title }}
        </a>
      </h3>

      <p class="meta">
        {{ post.author }} –
        {% if post.published_at %}
          {{ post.published_at.strftime('%d.%m.%Y %H:%M') }}
        {% else %}
          {{ post.created_at.strftime('%d.%m.%Y %H:%M') }}
        {% endif %}
</p>

      <p>
        {{ post.content[:200] }}
        {% if post.content|length > 200 %}...{% endif %}
      </p>

      <a href="/post/{{ post.slug }}" class="read-more">
        more →
      </a>
    </article>
  {% endfor %}

  {% if total_pages > 1 %}
    <div class="pagination">
      {% if page > 1 %}
        <a href="/?page={{ page - 1 }}&search={{ search }}">
          ← <!--← Back -->
        </a>
      {% endif %}

      <span>Page {{ page }} of {{ total_pages }}</span>

      {% if page < total_pages %}
        <a href="/?page={{ page + 1 }}&search={{ search }}">
          <!--Next --> →
        </a>
      {% endif %}
    </div>
  {% endif %}

{% else %}
  <p>
    There are no posts yet.
    <a href="/create">Create the first post!</a>
  </p>
{% endif %}

{% endblock %}